<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eliot's Weather App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .weather-card {
            background: white;
            border-radius: 30px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 400px;
            width: 100%;
        }

        h1 {
            color: #2d3436;
            font-size: 28px;
            margin-bottom: 10px;
        }

        .sun {
            font-size: 80px;
            margin: 20px 0;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .spinning {
            animation: spin 10s linear infinite;
        }

        .pulsing {
            animation: pulse 2s ease-in-out infinite;
        }

        .floating {
            animation: float 3s ease-in-out infinite;
        }

        .location {
            color: #636e72;
            font-size: 18px;
            margin-bottom: 20px;
        }

        .temp-box {
            background: #ffeaa7;
            border-radius: 20px;
            padding: 20px;
            margin: 15px 0;
        }

        .temp-box h2 {
            color: #d63031;
            font-size: 20px;
            margin-bottom: 10px;
        }

        .temp-number {
            font-size: 50px;
            font-weight: bold;
            color: #e17055;
        }

        .weekly-box {
            background: #81ecec;
            border-radius: 20px;
            padding: 20px;
            margin: 15px 0;
        }

        .weekly-box h2 {
            color: #00b894;
            font-size: 20px;
            margin-bottom: 10px;
        }

        .weekly-box .temp-number {
            color: #00b894;
        }

        .loading {
            color: #636e72;
            font-size: 18px;
        }

        .error {
            color: #d63031;
            font-size: 16px;
            padding: 20px;
        }

        button {
            background: #6c5ce7;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 15px;
            cursor: pointer;
            margin-top: 20px;
        }

        button:hover {
            background: #5f4ed3;
        }
    </style>
</head>
<body>
    <div class="weather-card">
        <h1>Eliot's Weather App</h1>
        <div class="sun" id="weather-icon">â˜€ï¸</div>
        <p class="location" id="location">Finding your location...</p>

        <div id="weather-info">
            <p class="loading">Loading weather data...</p>
        </div>

        <button onclick="getWeather()">Refresh</button>
        <button onclick="showWorldWeather()" style="background: #00b894;">Show Me Around The World ğŸŒ</button>
        <button onclick="goBack()" id="back-button" style="background: #fdcb6e; color: #2d3436; display: none;">â¬…ï¸ Back</button>
        <button onclick="showWalkTab()" style="background: #55efc4; color: #2d3436;">ğŸš¶ Best Time to Walk</button>
        <button onclick="toggleSettings()" style="background: #a29bfe;">âš™ï¸ Settings</button>

        <div id="settings-panel" style="display: none; background: #dfe6e9; border-radius: 20px; padding: 20px; margin-top: 20px; text-align: left;">
            <h3 style="color: #2d3436; margin-bottom: 15px;">âš™ï¸ Settings</h3>

            <div style="margin-bottom: 15px;">
                <label style="font-weight: bold; color: #2d3436;">Temperature:</label><br>
                <button onclick="setUnit('fahrenheit')" id="btn-f" style="background: #e17055; margin-top: 5px;">Â°F Fahrenheit</button>
                <button onclick="setUnit('celsius')" id="btn-c" style="background: #636e72; margin-top: 5px;">Â°C Celsius</button>
            </div>

            <div style="margin-bottom: 15px;">
                <label style="font-weight: bold; color: #2d3436;">App Color:</label><br>
                <button onclick="setColor('#74b9ff', '#0984e3')" style="background: #0984e3; margin-top: 5px;">Blue ğŸ’™</button>
                <button onclick="setColor('#fd79a8', '#e84393')" style="background: #e84393; margin-top: 5px;">Pink ğŸ’—</button>
                <button onclick="setColor('#55efc4', '#00b894')" style="background: #00b894; margin-top: 5px;">Green ğŸ’š</button>
                <button onclick="setColor('#ffeaa7', '#fdcb6e')" style="background: #fdcb6e; color: #2d3436; margin-top: 5px;">Yellow ğŸ’›</button>
                <button onclick="setColor('#a29bfe', '#6c5ce7')" style="background: #6c5ce7; margin-top: 5px;">Purple ğŸ’œ</button>
            </div>

            <div style="margin-bottom: 15px;">
                <label style="font-weight: bold; color: #2d3436;">Search a City:</label><br>
                <input type="text" id="city-input" placeholder="Type a city name..." style="padding: 10px; border-radius: 10px; border: 2px solid #b2bec3; margin-top: 5px; width: 100%; font-size: 16px;">
                <button onclick="searchCity()" style="background: #00cec9; margin-top: 10px;">ğŸ” Search</button>
            </div>

            <div style="margin-bottom: 15px;">
                <label style="font-weight: bold; color: #2d3436;">Dark Mode:</label><br>
                <button onclick="toggleDarkMode()" id="dark-mode-btn" style="background: #2d3436; margin-top: 5px;">ğŸŒ™ Dark Mode</button>
            </div>

            <div style="margin-bottom: 15px;">
                <label style="font-weight: bold; color: #2d3436;">Sound Effects:</label><br>
                <button onclick="toggleSound()" id="sound-btn" style="background: #00b894; margin-top: 5px;">ğŸ”Š Sound ON</button>
            </div>

            <button onclick="toggleSettings()" style="background: #636e72; margin-top: 10px;">Close Settings</button>
        </div>

        <div id="favorites-section" style="margin-top: 20px;">
            <h3 style="color: #2d3436; margin-bottom: 10px;">â­ Favorite Cities</h3>
            <div id="favorites-list"></div>
            <button onclick="addFavorite()" style="background: #fdcb6e; color: #2d3436; margin-top: 10px;">â­ Save Current City</button>
        </div>
    </div>

    <script>
        // Settings
        let tempUnit = 'fahrenheit';
        let darkMode = false;
        let soundOn = true;
        let currentCity = '';
        let favorites = JSON.parse(localStorage.getItem('weatherFavorites')) || [];

        // Sound effects using Web Audio
        function playSound(type) {
            if (!soundOn) return;
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            if (type === 'click') {
                oscillator.frequency.value = 800;
                gainNode.gain.value = 0.1;
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.1);
            } else if (type === 'success') {
                oscillator.frequency.value = 600;
                gainNode.gain.value = 0.1;
                oscillator.start();
                setTimeout(() => { oscillator.frequency.value = 800; }, 100);
                oscillator.stop(audioContext.currentTime + 0.2);
            }
        }

        // Toggle sound
        function toggleSound() {
            soundOn = !soundOn;
            const btn = document.getElementById('sound-btn');
            if (soundOn) {
                btn.textContent = 'ğŸ”Š Sound ON';
                btn.style.background = '#00b894';
                playSound('click');
            } else {
                btn.textContent = 'ğŸ”‡ Sound OFF';
                btn.style.background = '#636e72';
            }
        }

        // Dark mode
        function toggleDarkMode() {
            playSound('click');
            darkMode = !darkMode;
            const card = document.querySelector('.weather-card');
            const btn = document.getElementById('dark-mode-btn');
            const h1 = document.querySelector('h1');
            const favSection = document.getElementById('favorites-section');

            if (darkMode) {
                document.body.style.background = 'linear-gradient(135deg, #2d3436, #000000)';
                card.style.background = '#1e272e';
                card.style.color = 'white';
                h1.style.color = 'white';
                favSection.querySelector('h3').style.color = 'white';
                btn.textContent = 'â˜€ï¸ Light Mode';
                btn.style.background = '#ffeaa7';
                btn.style.color = '#2d3436';
            } else {
                document.body.style.background = 'linear-gradient(135deg, #74b9ff, #0984e3)';
                card.style.background = 'white';
                card.style.color = '#2d3436';
                h1.style.color = '#2d3436';
                favSection.querySelector('h3').style.color = '#2d3436';
                btn.textContent = 'ğŸŒ™ Dark Mode';
                btn.style.background = '#2d3436';
                btn.style.color = 'white';
            }
        }

        // Get weather icon based on weather code
        function getWeatherIcon(weatherCode) {
            // Weather codes from Open-Meteo
            if (weatherCode === 0) return 'â˜€ï¸'; // Clear
            if (weatherCode <= 3) return 'â›…'; // Partly cloudy
            if (weatherCode <= 49) return 'â˜ï¸'; // Cloudy/Fog
            if (weatherCode <= 59) return 'ğŸŒ§ï¸'; // Drizzle
            if (weatherCode <= 69) return 'ğŸŒ§ï¸'; // Rain
            if (weatherCode <= 79) return 'â„ï¸'; // Snow
            if (weatherCode <= 99) return 'â›ˆï¸'; // Thunderstorm
            return 'â˜€ï¸';
        }

        // Favorites
        function addFavorite() {
            playSound('success');
            if (!currentCity || favorites.includes(currentCity)) return;
            favorites.push(currentCity);
            localStorage.setItem('weatherFavorites', JSON.stringify(favorites));
            showFavorites();
        }

        function removeFavorite(city) {
            playSound('click');
            favorites = favorites.filter(f => f !== city);
            localStorage.setItem('weatherFavorites', JSON.stringify(favorites));
            showFavorites();
        }

        function showFavorites() {
            const list = document.getElementById('favorites-list');
            if (favorites.length === 0) {
                list.innerHTML = '<p style="color: #636e72; font-size: 14px;">No favorites yet!</p>';
                return;
            }
            list.innerHTML = favorites.map(city => `
                <div style="background: #dfe6e9; border-radius: 10px; padding: 10px; margin: 5px 0; display: flex; justify-content: space-between; align-items: center;">
                    <span style="cursor: pointer;" onclick="searchCityByName('${city}')">${city}</span>
                    <button onclick="removeFavorite('${city}')" style="background: #d63031; padding: 5px 10px; font-size: 12px;">âŒ</button>
                </div>
            `).join('');
        }

        function searchCityByName(cityName) {
            document.getElementById('city-input').value = cityName;
            searchCity();
        }

        // Load favorites on start
        showFavorites();

        // Walk preference (warmest or coolest)
        let walkPreference = 'warmest';

        // Show Best Time to Walk tab
        async function showWalkTab() {
            playSound('click');
            const weatherInfo = document.getElementById('weather-info');
            const locationText = document.getElementById('location');
            document.getElementById('back-button').style.display = 'inline-block';

            weatherInfo.innerHTML = '<p class="loading">Finding best walk time...</p>';

            try {
                // Get location
                const geoResponse = await fetch('https://ipapi.co/json/');
                const geoData = await geoResponse.json();
                const latitude = geoData.latitude;
                const longitude = geoData.longitude;
                locationText.textContent = 'ğŸ“ ' + geoData.city;

                // Get hourly weather
                const weatherUrl = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&hourly=temperature_2m&timezone=auto&temperature_unit=${tempUnit}`;
                const weatherResponse = await fetch(weatherUrl);
                const weatherData = await weatherResponse.json();

                showWalkResults(weatherData);

            } catch (error) {
                weatherInfo.innerHTML = '<p class="error">Oops! Could not get walk time. Try again!</p>';
            }
        }

        // Show walk results with toggle
        function showWalkResults(weatherData) {
            const weatherInfo = document.getElementById('weather-info');
            const unitSymbol = tempUnit === 'fahrenheit' ? 'Â°F' : 'Â°C';

            // Find best time between 7am (hour 7) and 8pm (hour 20)
            let bestWalkTime = '--';
            let bestWalkTemp = walkPreference === 'warmest' ? -999 : 999;
            let bestHourIndex = -1;

            if (weatherData.hourly && weatherData.hourly.temperature_2m) {
                for (let i = 7; i <= 20; i++) { // 7am to 8pm
                    const temp = weatherData.hourly.temperature_2m[i];
                    if (walkPreference === 'warmest') {
                        if (temp > bestWalkTemp) {
                            bestWalkTemp = temp;
                            bestHourIndex = i;
                        }
                    } else {
                        if (temp < bestWalkTemp) {
                            bestWalkTemp = temp;
                            bestHourIndex = i;
                        }
                    }
                }
                if (bestHourIndex >= 0) {
                    bestWalkTime = new Date(weatherData.hourly.time[bestHourIndex]).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                    bestWalkTemp = Math.round(bestWalkTemp);
                }
            }

            // Store weather data for toggle
            window.walkWeatherData = weatherData;

            const warmestActive = walkPreference === 'warmest' ? '#e17055' : '#636e72';
            const coolestActive = walkPreference === 'coolest' ? '#0984e3' : '#636e72';
            const boxColor = walkPreference === 'warmest' ? 'linear-gradient(135deg, #ff7675, #d63031)' : 'linear-gradient(135deg, #74b9ff, #0984e3)';
            const emoji = walkPreference === 'warmest' ? 'â˜€ï¸' : 'â„ï¸';

            weatherInfo.innerHTML = `
                <div style="background: #dfe6e9; border-radius: 20px; padding: 20px; margin: 15px 0;">
                    <h2 style="color: #2d3436; margin-bottom: 15px;">ğŸš¶ Best Time to Walk</h2>
                    <p style="color: #636e72; margin-bottom: 15px;">I want to walk when it's:</p>
                    <div style="display: flex; gap: 10px; justify-content: center; margin-bottom: 20px;">
                        <button onclick="setWalkPreference('warmest')" style="background: ${warmestActive}; padding: 15px 25px; font-size: 16px;">â˜€ï¸ Warmest</button>
                        <button onclick="setWalkPreference('coolest')" style="background: ${coolestActive}; padding: 15px 25px; font-size: 16px;">â„ï¸ Coolest</button>
                    </div>
                </div>
                <div style="background: ${boxColor}; border-radius: 20px; padding: 25px; margin: 15px 0; text-align: center;">
                    <div style="font-size: 50px; margin-bottom: 10px;">${emoji} ğŸš¶</div>
                    <h2 style="color: white; font-size: 20px;">Best Time for Your Walk</h2>
                    <div style="font-size: 48px; font-weight: bold; color: white; margin: 15px 0;">${bestWalkTime}</div>
                    <p style="color: rgba(255,255,255,0.8); font-size: 18px;">It will be ${bestWalkTemp}${unitSymbol}</p>
                </div>
                <p style="color: #636e72; font-size: 14px; text-align: center;">Between 7:00 AM and 8:00 PM</p>
            `;
        }

        // Set walk preference and refresh
        function setWalkPreference(pref) {
            playSound('click');
            walkPreference = pref;
            if (window.walkWeatherData) {
                showWalkResults(window.walkWeatherData);
            }
        }

        // Store forecast data for radar
        let forecastData = null;

        // Show radar/chart when clicking on temperature or wind
        function showRadar(type) {
            playSound('click');
            if (!forecastData) return;

            const weatherInfo = document.getElementById('weather-info');
            const days = ['Today', 'Tomorrow', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7'];
            const unitSymbol = tempUnit === 'fahrenheit' ? 'Â°F' : 'Â°C';

            let data, title, color, suffix;
            if (type === 'temp') {
                data = forecastData.daily.temperature_2m_max;
                title = 'ğŸŒ¡ï¸ Temperature Forecast';
                color = '#e17055';
                suffix = unitSymbol;
            } else if (type === 'wind') {
                data = forecastData.daily.windspeed_10m_max || [10, 12, 8, 15, 11, 9, 13];
                title = 'ğŸ’¨ Wind Speed Forecast';
                color = '#0984e3';
                suffix = ' mph';
            } else if (type === 'rain') {
                data = forecastData.daily.precipitation_probability_max || [20, 30, 10, 50, 40, 25, 15];
                title = 'ğŸŒ§ï¸ Rain Chance Forecast';
                color = '#a29bfe';
                suffix = '%';
            }

            // Find max value for scaling the bars
            const maxVal = Math.max(...data.slice(0, 7));

            // Build the radar/chart
            let chartHTML = `
                <div style="background: linear-gradient(135deg, #2d3436, #636e72); border-radius: 20px; padding: 20px; margin: 15px 0;">
                    <h2 style="color: white; margin-bottom: 15px;">${title}</h2>
                    <div style="display: flex; justify-content: space-around; align-items: flex-end; height: 150px; padding: 10px;">
            `;

            for (let i = 0; i < 7 && i < data.length; i++) {
                const value = Math.round(data[i]);
                const barHeight = (value / maxVal) * 100;
                chartHTML += `
                    <div style="text-align: center; flex: 1;">
                        <div style="color: white; font-size: 12px; margin-bottom: 5px;">${value}${suffix}</div>
                        <div style="background: ${color}; width: 30px; height: ${barHeight}px; margin: 0 auto; border-radius: 5px 5px 0 0;"></div>
                        <div style="color: #b2bec3; font-size: 10px; margin-top: 5px;">${days[i]}</div>
                    </div>
                `;
            }

            chartHTML += `
                    </div>
                    <button onclick="getWeather()" style="background: #00b894; margin-top: 15px;">â¬…ï¸ Back to Weather</button>
                </div>
            `;

            weatherInfo.innerHTML = chartHTML;
        }

        // Toggle settings panel
        function toggleSettings() {
            const panel = document.getElementById('settings-panel');
            if (panel.style.display === 'none') {
                panel.style.display = 'block';
            } else {
                panel.style.display = 'none';
            }
        }

        // Change temperature unit
        function setUnit(unit) {
            tempUnit = unit;
            if (unit === 'fahrenheit') {
                document.getElementById('btn-f').style.background = '#e17055';
                document.getElementById('btn-c').style.background = '#636e72';
            } else {
                document.getElementById('btn-f').style.background = '#636e72';
                document.getElementById('btn-c').style.background = '#e17055';
            }
            getWeather();
        }

        // Change app color
        function setColor(color1, color2) {
            document.body.style.background = `linear-gradient(135deg, ${color1}, ${color2})`;
        }

        // Search for a city
        async function searchCity() {
            const cityName = document.getElementById('city-input').value;
            if (!cityName) return;

            const weatherInfo = document.getElementById('weather-info');
            const locationText = document.getElementById('location');

            weatherInfo.innerHTML = '<p class="loading">Searching...</p>';

            try {
                // Find the city's coordinates
                const geoUrl = `https://geocoding-api.open-meteo.com/v1/search?name=${cityName}&count=1`;
                const geoResponse = await fetch(geoUrl);
                const geoData = await geoResponse.json();

                if (!geoData.results || geoData.results.length === 0) {
                    weatherInfo.innerHTML = '<p class="error">City not found! Try again.</p>';
                    return;
                }

                const city = geoData.results[0];
                locationText.textContent = 'ğŸ“ ' + city.name + ', ' + (city.country || '');

                // Get weather for that city
                const weatherUrl = `https://api.open-meteo.com/v1/forecast?latitude=${city.latitude}&longitude=${city.longitude}&daily=temperature_2m_max,weathercode,windspeed_10m_max,precipitation_probability_max,sunrise,sunset&hourly=temperature_2m&current_weather=true&timezone=auto&temperature_unit=${tempUnit}`;
                const weatherResponse = await fetch(weatherUrl);
                const weatherData = await weatherResponse.json();

                // Save forecast data for radar
                forecastData = weatherData;

                const todayHigh = Math.round(weatherData.daily.temperature_2m_max[0]);
                const weeklyHigh = Math.round(Math.max(...weatherData.daily.temperature_2m_max));
                const unitSymbol = tempUnit === 'fahrenheit' ? 'Â°F' : 'Â°C';

                // Get weather icon and wind speed
                const weatherCode = weatherData.current_weather.weathercode;
                const windSpeed = Math.round(weatherData.current_weather.windspeed);
                const icon = getWeatherIcon(weatherCode);
                document.getElementById('weather-icon').textContent = icon;

                // Save current city
                currentCity = city.name + ', ' + (city.country || '');

                playSound('success');

                // Get rain chance
                const rainChance = weatherData.daily.precipitation_probability_max ? weatherData.daily.precipitation_probability_max[0] : 0;

                // Get sunrise and sunset
                const sunriseTime = weatherData.daily.sunrise ? new Date(weatherData.daily.sunrise[0]).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : '--';
                const sunsetTime = weatherData.daily.sunset ? new Date(weatherData.daily.sunset[0]).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : '--';

                // Find the best time today (coolest in summer, hottest in winter)
                let bestTime = '--';
                let bestTemp = 0;
                let isSummer = false;
                const month = new Date().getMonth();
                isSummer = (month >= 4 && month <= 8);

                if (weatherData.hourly && weatherData.hourly.temperature_2m) {
                    if (isSummer) {
                        bestTemp = 999;
                        for (let i = 0; i < 24; i++) {
                            if (weatherData.hourly.temperature_2m[i] < bestTemp) {
                                bestTemp = weatherData.hourly.temperature_2m[i];
                                bestTime = new Date(weatherData.hourly.time[i]).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                            }
                        }
                    } else {
                        bestTemp = -999;
                        for (let i = 0; i < 24; i++) {
                            if (weatherData.hourly.temperature_2m[i] > bestTemp) {
                                bestTemp = weatherData.hourly.temperature_2m[i];
                                bestTime = new Date(weatherData.hourly.time[i]).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                            }
                        }
                    }
                    bestTemp = Math.round(bestTemp);
                }
                const bestTimeLabel = isSummer ? 'â„ï¸ Coolest Time Today' : 'ğŸ”¥ Hottest Time Today';
                const bestTimeColor = isSummer ? 'linear-gradient(135deg, #74b9ff, #0984e3)' : 'linear-gradient(135deg, #ff7675, #d63031)';
                const bestTimeSubColor = isSummer ? '#bee5ff' : '#fab1a0';

                // Check for weather alerts
                let alertHTML = '';
                if (weatherCode >= 95) {
                    alertHTML = `<div style="background: #d63031; border-radius: 20px; padding: 15px; margin: 15px 0; animation: pulse 1s infinite;">
                        <h2 style="color: white; font-size: 18px;">âš ï¸ STORM ALERT!</h2>
                        <p style="color: white;">Thunderstorms expected! Stay safe indoors!</p>
                    </div>`;
                } else if (weatherCode >= 61 && weatherCode <= 67) {
                    alertHTML = `<div style="background: #0984e3; border-radius: 20px; padding: 15px; margin: 15px 0;">
                        <h2 style="color: white; font-size: 18px;">ğŸŒ§ï¸ Rain Alert</h2>
                        <p style="color: white;">Rain expected today. Bring an umbrella!</p>
                    </div>`;
                } else if (weatherCode >= 71 && weatherCode <= 77) {
                    alertHTML = `<div style="background: #74b9ff; border-radius: 20px; padding: 15px; margin: 15px 0;">
                        <h2 style="color: white; font-size: 18px;">â„ï¸ Snow Alert</h2>
                        <p style="color: white;">Snow is falling! Bundle up warm!</p>
                    </div>`;
                } else if (windSpeed > 30) {
                    alertHTML = `<div style="background: #fdcb6e; border-radius: 20px; padding: 15px; margin: 15px 0;">
                        <h2 style="color: #2d3436; font-size: 18px;">ğŸ’¨ Wind Alert</h2>
                        <p style="color: #2d3436;">Strong winds today! Hold onto your hat!</p>
                    </div>`;
                }

                weatherInfo.innerHTML = `
                    ${alertHTML}
                    <div class="temp-box" onclick="showRadar('temp')" style="cursor: pointer;">
                        <h2>Today's Peak Temperature</h2>
                        <div class="temp-number">${todayHigh}${unitSymbol}</div>
                        <p style="font-size: 12px; color: #636e72; margin-top: 5px;">ğŸ‘† Tap for forecast</p>
                    </div>
                    <div class="weekly-box" onclick="showRadar('temp')" style="cursor: pointer;">
                        <h2>This Week's Peak Temperature</h2>
                        <div class="temp-number">${weeklyHigh}${unitSymbol}</div>
                        <p style="font-size: 12px; color: #636e72; margin-top: 5px;">ğŸ‘† Tap for forecast</p>
                    </div>
                    <div style="background: #b2bec3; border-radius: 20px; padding: 15px; margin: 15px 0; cursor: pointer;" onclick="showRadar('wind')">
                        <h2 style="color: #2d3436; font-size: 18px;">ğŸ’¨ Wind Speed</h2>
                        <div style="font-size: 30px; font-weight: bold; color: #0984e3;">${windSpeed} mph</div>
                        <p style="font-size: 12px; color: #636e72; margin-top: 5px;">ğŸ‘† Tap for forecast</p>
                    </div>
                    <div style="background: #a29bfe; border-radius: 20px; padding: 15px; margin: 15px 0; cursor: pointer;" onclick="showRadar('rain')">
                        <h2 style="color: white; font-size: 18px;">ğŸŒ§ï¸ Rain Chance</h2>
                        <div style="font-size: 30px; font-weight: bold; color: white;">${rainChance}%</div>
                        <p style="font-size: 12px; color: #dfe6e9; margin-top: 5px;">ğŸ‘† Tap for forecast</p>
                    </div>
                    <div style="background: ${bestTimeColor}; border-radius: 20px; padding: 15px; margin: 15px 0; text-align: center;">
                        <h2 style="color: white; font-size: 18px;">${bestTimeLabel}</h2>
                        <div style="font-size: 36px; font-weight: bold; color: white;">${bestTime}</div>
                        <p style="color: ${bestTimeSubColor}; font-size: 14px;">${bestTemp}${unitSymbol}</p>
                    </div>
                    <div style="display: flex; gap: 10px; margin: 15px 0;">
                        <div style="background: #ffeaa7; border-radius: 20px; padding: 15px; flex: 1; text-align: center;">
                            <h2 style="color: #2d3436; font-size: 16px;">ğŸŒ… Sunrise</h2>
                            <div style="font-size: 24px; font-weight: bold; color: #e17055;">${sunriseTime}</div>
                        </div>
                        <div style="background: #636e72; border-radius: 20px; padding: 15px; flex: 1; text-align: center;">
                            <h2 style="color: white; font-size: 16px;">ğŸŒ‡ Sunset</h2>
                            <div style="font-size: 24px; font-weight: bold; color: #ffeaa7;">${sunsetTime}</div>
                        </div>
                    </div>
                `;
            } catch (error) {
                weatherInfo.innerHTML = '<p class="error">Oops! Something went wrong.</p>';
            }
        }

        // This function gets the weather
        async function getWeather() {
            const weatherInfo = document.getElementById('weather-info');
            const locationText = document.getElementById('location');

            weatherInfo.innerHTML = '<p class="loading">Loading weather data...</p>';

            try {
                // First, find where you are
                const geoResponse = await fetch('https://ipapi.co/json/');
                const geoData = await geoResponse.json();

                const city = geoData.city;
                const latitude = geoData.latitude;
                const longitude = geoData.longitude;

                locationText.textContent = 'ğŸ“ ' + city;

                // Now get the weather for your location
                const weatherUrl = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&daily=temperature_2m_max,weathercode,windspeed_10m_max,precipitation_probability_max,sunrise,sunset&hourly=temperature_2m&current_weather=true&timezone=auto&temperature_unit=${tempUnit}`;

                const weatherResponse = await fetch(weatherUrl);
                const weatherData = await weatherResponse.json();

                // Save forecast data for radar
                forecastData = weatherData;

                // Get today's peak temperature
                const todayHigh = Math.round(weatherData.daily.temperature_2m_max[0]);

                // Find the highest temperature this week
                const allHighs = weatherData.daily.temperature_2m_max;
                const weeklyHigh = Math.round(Math.max(...allHighs));
                const unitSymbol = tempUnit === 'fahrenheit' ? 'Â°F' : 'Â°C';

                // Get weather icon and wind speed
                const weatherCode = weatherData.current_weather.weathercode;
                const windSpeed = Math.round(weatherData.current_weather.windspeed);
                const icon = getWeatherIcon(weatherCode);
                document.getElementById('weather-icon').textContent = icon;

                // Save current city
                currentCity = city;

                // Get rain chance
                const rainChance = weatherData.daily.precipitation_probability_max ? weatherData.daily.precipitation_probability_max[0] : 0;

                // Get sunrise and sunset
                const sunriseTime = weatherData.daily.sunrise ? new Date(weatherData.daily.sunrise[0]).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : '--';
                const sunsetTime = weatherData.daily.sunset ? new Date(weatherData.daily.sunset[0]).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : '--';

                // Find the best time today (coolest in summer, hottest in winter)
                let bestTime = '--';
                let bestTemp = 0;
                let isSummer = false;
                const month = new Date().getMonth(); // 0-11
                // Summer is May-September (months 4-8), Winter is October-April
                isSummer = (month >= 4 && month <= 8);

                if (weatherData.hourly && weatherData.hourly.temperature_2m) {
                    if (isSummer) {
                        // Find coolest time in summer
                        bestTemp = 999;
                        for (let i = 0; i < 24; i++) {
                            if (weatherData.hourly.temperature_2m[i] < bestTemp) {
                                bestTemp = weatherData.hourly.temperature_2m[i];
                                bestTime = new Date(weatherData.hourly.time[i]).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                            }
                        }
                    } else {
                        // Find hottest time in winter
                        bestTemp = -999;
                        for (let i = 0; i < 24; i++) {
                            if (weatherData.hourly.temperature_2m[i] > bestTemp) {
                                bestTemp = weatherData.hourly.temperature_2m[i];
                                bestTime = new Date(weatherData.hourly.time[i]).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                            }
                        }
                    }
                    bestTemp = Math.round(bestTemp);
                }
                const bestTimeLabel = isSummer ? 'â„ï¸ Coolest Time Today' : 'ğŸ”¥ Hottest Time Today';
                const bestTimeColor = isSummer ? 'linear-gradient(135deg, #74b9ff, #0984e3)' : 'linear-gradient(135deg, #ff7675, #d63031)';
                const bestTimeSubColor = isSummer ? '#bee5ff' : '#fab1a0';

                // Check for weather alerts (storms, heavy rain, etc.)
                let alertHTML = '';
                if (weatherCode >= 95) {
                    alertHTML = `<div style="background: #d63031; border-radius: 20px; padding: 15px; margin: 15px 0; animation: pulse 1s infinite;">
                        <h2 style="color: white; font-size: 18px;">âš ï¸ STORM ALERT!</h2>
                        <p style="color: white;">Thunderstorms expected! Stay safe indoors!</p>
                    </div>`;
                } else if (weatherCode >= 61 && weatherCode <= 67) {
                    alertHTML = `<div style="background: #0984e3; border-radius: 20px; padding: 15px; margin: 15px 0;">
                        <h2 style="color: white; font-size: 18px;">ğŸŒ§ï¸ Rain Alert</h2>
                        <p style="color: white;">Rain expected today. Bring an umbrella!</p>
                    </div>`;
                } else if (weatherCode >= 71 && weatherCode <= 77) {
                    alertHTML = `<div style="background: #74b9ff; border-radius: 20px; padding: 15px; margin: 15px 0;">
                        <h2 style="color: white; font-size: 18px;">â„ï¸ Snow Alert</h2>
                        <p style="color: white;">Snow is falling! Bundle up warm!</p>
                    </div>`;
                } else if (windSpeed > 30) {
                    alertHTML = `<div style="background: #fdcb6e; border-radius: 20px; padding: 15px; margin: 15px 0;">
                        <h2 style="color: #2d3436; font-size: 18px;">ğŸ’¨ Wind Alert</h2>
                        <p style="color: #2d3436;">Strong winds today! Hold onto your hat!</p>
                    </div>`;
                }

                // Show the temperatures (clickable for radar!)
                weatherInfo.innerHTML = `
                    ${alertHTML}
                    <div class="temp-box" onclick="showRadar('temp')" style="cursor: pointer;">
                        <h2>Today's Peak Temperature</h2>
                        <div class="temp-number">${todayHigh}${unitSymbol}</div>
                        <p style="font-size: 12px; color: #636e72; margin-top: 5px;">ğŸ‘† Tap for forecast</p>
                    </div>
                    <div class="weekly-box" onclick="showRadar('temp')" style="cursor: pointer;">
                        <h2>This Week's Peak Temperature</h2>
                        <div class="temp-number">${weeklyHigh}${unitSymbol}</div>
                        <p style="font-size: 12px; color: #636e72; margin-top: 5px;">ğŸ‘† Tap for forecast</p>
                    </div>
                    <div style="background: #b2bec3; border-radius: 20px; padding: 15px; margin: 15px 0; cursor: pointer;" onclick="showRadar('wind')">
                        <h2 style="color: #2d3436; font-size: 18px;">ğŸ’¨ Wind Speed</h2>
                        <div style="font-size: 30px; font-weight: bold; color: #0984e3;">${windSpeed} mph</div>
                        <p style="font-size: 12px; color: #636e72; margin-top: 5px;">ğŸ‘† Tap for forecast</p>
                    </div>
                    <div style="background: #a29bfe; border-radius: 20px; padding: 15px; margin: 15px 0; cursor: pointer;" onclick="showRadar('rain')">
                        <h2 style="color: white; font-size: 18px;">ğŸŒ§ï¸ Rain Chance</h2>
                        <div style="font-size: 30px; font-weight: bold; color: white;">${rainChance}%</div>
                        <p style="font-size: 12px; color: #dfe6e9; margin-top: 5px;">ğŸ‘† Tap for forecast</p>
                    </div>
                    <div style="background: ${bestTimeColor}; border-radius: 20px; padding: 15px; margin: 15px 0; text-align: center;">
                        <h2 style="color: white; font-size: 18px;">${bestTimeLabel}</h2>
                        <div style="font-size: 36px; font-weight: bold; color: white;">${bestTime}</div>
                        <p style="color: ${bestTimeSubColor}; font-size: 14px;">${bestTemp}${unitSymbol}</p>
                    </div>
                    <div style="display: flex; gap: 10px; margin: 15px 0;">
                        <div style="background: #ffeaa7; border-radius: 20px; padding: 15px; flex: 1; text-align: center;">
                            <h2 style="color: #2d3436; font-size: 16px;">ğŸŒ… Sunrise</h2>
                            <div style="font-size: 24px; font-weight: bold; color: #e17055;">${sunriseTime}</div>
                        </div>
                        <div style="background: #636e72; border-radius: 20px; padding: 15px; flex: 1; text-align: center;">
                            <h2 style="color: white; font-size: 16px;">ğŸŒ‡ Sunset</h2>
                            <div style="font-size: 24px; font-weight: bold; color: #ffeaa7;">${sunsetTime}</div>
                        </div>
                    </div>
                `;

            } catch (error) {
                weatherInfo.innerHTML = '<p class="error">Oops! Could not get weather. Try again!</p>';
                console.log('Error:', error);
            }
        }

        // Fun cities around the world!
        const worldCities = [
            { name: "Tokyo, Japan", lat: 35.68, lon: 139.76, flag: "ğŸ‡¯ğŸ‡µ" },
            { name: "Paris, France", lat: 48.85, lon: 2.35, flag: "ğŸ‡«ğŸ‡·" },
            { name: "Sydney, Australia", lat: -33.87, lon: 151.21, flag: "ğŸ‡¦ğŸ‡º" },
            { name: "Cairo, Egypt", lat: 30.04, lon: 31.24, flag: "ğŸ‡ªğŸ‡¬" },
            { name: "Rio de Janeiro, Brazil", lat: -22.91, lon: -43.17, flag: "ğŸ‡§ğŸ‡·" },
            { name: "London, England", lat: 51.51, lon: -0.13, flag: "ğŸ‡¬ğŸ‡§" },
            { name: "New York, USA", lat: 40.71, lon: -74.01, flag: "ğŸ‡ºğŸ‡¸" },
            { name: "Beijing, China", lat: 39.90, lon: 116.41, flag: "ğŸ‡¨ğŸ‡³" },
            { name: "Moscow, Russia", lat: 55.76, lon: 37.62, flag: "ğŸ‡·ğŸ‡º" },
            { name: "Dubai, UAE", lat: 25.20, lon: 55.27, flag: "ğŸ‡¦ğŸ‡ª" },
            { name: "Cape Town, South Africa", lat: -33.93, lon: 18.42, flag: "ğŸ‡¿ğŸ‡¦" },
            { name: "Mumbai, India", lat: 19.08, lon: 72.88, flag: "ğŸ‡®ğŸ‡³" },
            { name: "Mexico City, Mexico", lat: 19.43, lon: -99.13, flag: "ğŸ‡²ğŸ‡½" },
            { name: "Rome, Italy", lat: 41.90, lon: 12.50, flag: "ğŸ‡®ğŸ‡¹" },
            { name: "Seoul, South Korea", lat: 37.57, lon: 126.98, flag: "ğŸ‡°ğŸ‡·" },
            { name: "Toronto, Canada", lat: 43.65, lon: -79.38, flag: "ğŸ‡¨ğŸ‡¦" },
            { name: "Berlin, Germany", lat: 52.52, lon: 13.41, flag: "ğŸ‡©ğŸ‡ª" },
            { name: "Bangkok, Thailand", lat: 13.76, lon: 100.50, flag: "ğŸ‡¹ğŸ‡­" },
            { name: "Athens, Greece", lat: 37.98, lon: 23.73, flag: "ğŸ‡¬ğŸ‡·" },
            { name: "Reykjavik, Iceland", lat: 64.15, lon: -21.94, flag: "ğŸ‡®ğŸ‡¸" }
        ];

        // Show weather around the world
        async function showWorldWeather() {
            const weatherInfo = document.getElementById('weather-info');
            const locationText = document.getElementById('location');

            locationText.textContent = 'ğŸŒ Around The World!';
            weatherInfo.innerHTML = '<p class="loading">Loading world weather...</p>';
            document.getElementById('back-button').style.display = 'inline-block';

            try {
                let worldHTML = '';

                for (const city of worldCities) {
                    const weatherUrl = `https://api.open-meteo.com/v1/forecast?latitude=${city.lat}&longitude=${city.lon}&daily=temperature_2m_max&timezone=auto&temperature_unit=fahrenheit`;
                    const response = await fetch(weatherUrl);
                    const data = await response.json();
                    const temp = Math.round(data.daily.temperature_2m_max[0]);

                    worldHTML += `
                        <div style="background: #dfe6e9; border-radius: 15px; padding: 15px; margin: 10px 0; text-align: left;">
                            <span style="font-size: 24px;">${city.flag}</span>
                            <strong>${city.name}</strong>
                            <span style="float: right; color: #e17055; font-weight: bold;">${temp}Â°F</span>
                        </div>
                    `;
                }

                weatherInfo.innerHTML = worldHTML;

            } catch (error) {
                weatherInfo.innerHTML = '<p class="error">Oops! Could not get world weather. Try again!</p>';
            }
        }

        // Go back to your local weather
        function goBack() {
            document.getElementById('back-button').style.display = 'none';
            getWeather();
        }

        // Get weather when the page loads
        getWeather();
    </script>
</body>
</html>
